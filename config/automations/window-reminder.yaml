alias: Window Close Reminder
trigger:
  platform: state
  entity_id:
    - binary_sensor.guest_bathroom_window_lumi_contact
  to: 'on'
  for:
    minutes: 5
condition:
  - condition: or
    conditions:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'on'
      - condition: numeric_state
        entity_id: weather.home
        attribute: temperature
        below: 16
action:
  - alias: Repeat notification until entity is closed
    repeat:
      until:
        - condition: state
          entity_id: binary_sensor.guest_bathroom_window_lumi_contact
          state: 'off'
      sequence:
        # send reminder notification
        - service: notify.slack
          data_template:
            title: Close Reminder
            message: >
              :window: The {{ trigger.to_state.attributes.friendly_name }} is open for 5 minutes with {{ state_attr('weather.home', 'temperature') }}Â°C outside - close it now!

        # wait 5 minutes until next notification
        - delay: '00:05'
